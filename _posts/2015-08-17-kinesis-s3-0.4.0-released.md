---
layout: post
shortenedlink: Kinesis S3 0.4.0 released
title: Kinesis S3 0.4.0 released
tags: [snowplow, kinesis, s3, amazon s3, real-time]
author: Josh
category: Releases
---

We are pleased to announce the release of Kinesis S3 version 0.4.0. Many thanks to [Kacper Bielecki][kazjote] for his contribution to this release!

Table of contents:

1. [GZip support](/blog/2015/08/17/snowplow-kinesis-s3-0.4.0-released#gzip-support)
2. [Infinite loops](/blog/2015/08/17/snowplow-kinesis-s3-0.4.0-released#loops)
3. [Application control](/blog/2015/08/17/snowplow-kinesis-s3-0.4.0-released#control)
4. [Upgrading](/blog/2015/08/17/snowplow-kinesis-s3-0.4.0-released#upgrading)
5. [Getting help](/blog/2015/08/17/snowplow-kinesis-s3-0.4.0-released#help)

<!--more-->

<h2 id="gzip-support">1. GZip Support</h2>

We now have support for a second file format; [GZip][gzip].  Under this format each record is treated as a a byte array containing a UTF-8 encoded string (whether CSV, JSON or TSV).  The records are then written to file seperated by new lines.

Big thanks go to [Kacper Bielecki][kazjote] for adding this file format!  For more information [#43][pr-43].

<h2 id="loops">2. Infinite loops</h2>

With the recent Amazon S3 outage in US Standard an issue was discovered where the application was unable to recover the connection to S3 even after the service was restored.  This resulted in an infinite loop of failure to `PUT` any records into S3.  The only way we were able to get the application to communicate with S3 again was to restart the application.

To this end we have now included a timeout in which the application is allowed to fail before it is ended.  You can specify this timeout in the hocon:

{% highlight json %}
// Failure allowed for one minute
sink.s3.max-timeout: 60000
{% endhighlight %}

This feature can be neatly coupled with an automated restart wrapper to ensure that the application will recover without human intervention.

<h2 id="control">3. Application control</h2>

From the [previous post][previous-rel] we talked about several issues surrounding running out of memory with this application.  To further alleviate any issues surrounding overt memory consumption we have implemented a new configuration option; `maximum records`.  You can now specify how many records the application is allowed to read per `GetRecords` call.  Effectively preventing the application from suddenly exceeding the heap with sudden spikes in traffic.

<h2 id="upgrading">4. Upgrading</h2>

The Kinesis S3 application is now all available in a single zip file here:

    http://bintray.com/artifact/download/snowplow/snowplow-generic/kinesis_s3_0.4.0.zip

Upgrading will require various configuration changes to the application's HOCON configuration file:

* Add `max-records` to the `sink.kinesis.in` section and configure how many records you want the application to get at any one time.
* Add `format` to the `sink.s3` section and select either `lzo` or `gzip` to control what format files are written in.
* Add `max-timeout` to the `sink.s3` section and (in ms) enter the maximum timeout for the application.

And that's it - you should now be fully upgraded!

<h2 id="help">5. Getting help</h2>

For more details on this release, please check out the [Kinesis S3 0.4.0 release][0.4.0-release] on GitHub. 

If you have any questions or run into any problems, please [raise an issue][issues] or get in touch with us through [the usual channels][talk-to-us].

[kazjote]: https://github.com/kazjote
[gzip]: http://www.gzip.org/
[pr-43]: https://github.com/snowplow/kinesis-s3/pull/43
[previous-rel]: http://snowplowanalytics.com/blog/2015/07/07/kinesis-s3-0.3.0-released/
[issues]: https://github.com/snowplow/kinesis-s3/issues
[talk-to-us]: https://github.com/snowplow/kinesis-s3/wiki/Talk-to-us
[0.4.0-release]: https://github.com/snowplow/kinesis-s3/releases/tag/0.4.0
