---
layout: post
shortenedlink: Semantic event modeling and entity snapshotting
title: Semantic event modeling and entity snapshotting
tags: [event, analytics, grammar, model, entities]
author: Alex
category: Research
---

At Snowplow we spend a lot of time thinking about how to model events. As businesses re-orient themselves around event streams under the [Unified Log model] [kreps], it becomes ever more important to properly model those event streams. After all: "garbage in" means "garbage out": deriving business value from events is hugely dependent on modeling those events correctly in the first place.

Our focus at Snowplow has been on defining a **semantic model** for events: one that is built around the intrinsic properties found across all events. A semantic model helps to prevent business and technology assumptions from leaking into the event stream. This works to guard against outdated assumptions becoming "fossilized" in the event stream, and helps to make those streams significantly less brittle - and easier to evolve - over time.

We proposed an initial model for Snowplow events in our August 2013 blog post, [Towards universal event analytics - building an event grammar] [event-grammar]. We have since discussed this approach with many interested parties, and have been pleased to follow other explorations of the topic, for example CARMEN'S BLOG POST SERIES. I've also made heavy use of this proposed event grammar in my book, [Unified Log Processing] [dean]. The semantic approach seems to have resonated widely.

However, our thinking has evolved from our original event grammar proposal in one important aspect. During the 18 months elapsed since that blog post, we have been exposed to many more event streams defined by many more customers, and we have also had the chance to experiment with aspects of the event grammar through Snowplow's own unstructured events, its custom contexts and more generally with our new [Iglu] [iglu] project. What we have learnt from all this can be summed up like so:

> An event is anything that we can observe occurring at a particular point in time. Each event is recorded as the set of relevant entities as they stood at that point in time

This statement may seem unrelated - perhaps even contradictory - to our original definition of an event grammar with six dedicated "slots" containing: Subject, Verb, Object, Indirect Object, Prepositional Object and Context. In fact, they are closely related and broadly complementary, and understanding the role of entities in events should allow us to derive a "version 2" of our event grammar which is significantly simpler and also more powerful.

In the rest of this blog post, we will XXXXXXXXXXX

CONTENTS SECTION?

<!--more-->

<div class="html">
<h2><a name="emitters">1. Introducing entities</a></h2>
</div>

What is an entity? In event modeling terms, an entity is a thing or object which is somehow _relevant to_ the event that we are observing. For example, in the sentence "I watched Interstellar at my local theatre", myself, the movie and the movie theatre are all entities. We use the word "entity" because the word "object" is too loaded - it has too many connotations from Object-Oriented Programming (OOP), and it also has a separate grammatical meaning in terms of the "subject" of a verb versus the "object" of a verb.

ADD DIAGRAM

Entities are everywhere in software. MySQL tables, backbone.js models, Protocol Buffers, JSONs, Plain Old Java Objects, XML documents, Haskell records - as programmers we spend an inordinate amount of time working with the entities that matter to our systems. It is no coincidence that these entities play a huge role in the events which occur in and around our software too.

There is a lot of confusion around the role of entities within events - even to the extent of one analytics company arguing that entity data is [completely distinct] [keen-entities-vs-events] from event data. In fact nothing could be further from the truth - as we'll soon see, our events consist of almost _nothing but_ entities. But before we look at the event-entity relationship, we need to understand how entities interact with time.

<div class="html">
<h2><a name="emitters">2. Entities over time</a></h2>
</div>

> Has it ever struck you that life is all memory, except for the one present moment that goes by you so quick you hardly catch it going?

Tennessee Williams, The Milk Train Doesn't Stop Here Anymore

In the real world as in software, entities change over time. If we can view our entities as consisting of properties, we can divide these properties into three approximate buckets:

* **Permanent or static properties** - properties that don't change over the lifetime of the entity. For example, my eye color
* **Infrequently changing properties** - properties that change infrequently, for instance my email address
* **Frequently changing properties** - properties that frequently change. For example, my geographical location

The exact taxonomy is not set in stone - for example, a person's height will start as a frequently changing property, become a static property in adulthood, and then switch to an infrequently changing property as she grows older. Nor do these properties necessarily change in particularly directional or meaningful ways over time: my geographical location has patterns in it (such as my daily commute), but there's no overarching theme across all the data.

Let's imagine that I'm playing a mobile game, and saving my progress as I go. Across three distinct save game events

Writing the early chapters Unified Log Processing book, I've realized that there are some 

in a grammatical context too: it's much clearer to say that the event's subject and its direct object are both entities, than it is to say that the event's subject and its direct object are objects.

An entity



[kreps]: xxx
[dean]: http://manning.com/dean/

[event-grammar]: /blog/2013/08/12/towards-universal-event-analytics-building-an-event-grammar
[iglu]: 

[keen-entities-vs-events]: https://keen.io/blog/53958349217/analytics-for-hackers-how-to-think-about-event-data
